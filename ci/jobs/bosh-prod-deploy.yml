tags: [bosh]
public: true
serial: true
interruptible: true
plan:
- aggregate:
  - get: concourse
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: version
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: concourse-release
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: postgres-release
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: bpm-release
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: gcp-xenial-stemcell
    passed: [bosh-smoke, bosh-topgun]
    trigger: true
  - get: cbd
    trigger: true
  - get: gcp-windows-stemcell
  - get: bbr-sdk-release
  - get: prod
- put: prod-deployment
  params:
    manifest: cbd/cluster/concourse.yml
    stemcells:
    - gcp-xenial-stemcell/*.tgz
    - gcp-windows-stemcell/*.tgz
    releases:
    - concourse-release/*.tgz
    - postgres-release/*.tgz
    - bpm-release/*.tgz
    - bbr-sdk-release/*.tgz
    ops_files:
    - cbd/cluster/operations/scale.yml
    - cbd/cluster/operations/dev-versions.yml
    - cbd/cluster/operations/privileged-http.yml
    - cbd/cluster/operations/tls.yml
    - cbd/cluster/operations/privileged-https.yml
    - cbd/cluster/operations/basic-auth.yml
    - cbd/cluster/operations/github-auth.yml
    - cbd/cluster/operations/encryption.yml
    - cbd/cluster/operations/vault-tls-cert-auth.yml
    - cbd/cluster/operations/influxdb.yml
    - cbd/cluster/operations/db-stats.yml
    - cbd/cluster/operations/web-network-extension.yml
    - cbd/cluster/operations/team-authorized-keys.yml
    - cbd/cluster/operations/untrusted-worker.yml
    - cbd/cluster/operations/debug-untrusted-worker.yml
    - cbd/cluster/operations/scale-untrusted-worker.yml
    - cbd/cluster/operations/windows-worker.yml
    - cbd/cluster/operations/telegraf-postgres.yml
    - cbd/cluster/operations/syslog_forwarder.yml
    - cbd/cluster/operations/backup-atc.yml
    - cbd/cluster/operations/task-limits.yml
    - cbd/cluster/operations/windows-worker-network.yml
    - cbd/cluster/operations/debug-concourse.yml
    - cbd/cluster/operations/syslog-drainer.yml
    - cbd/cluster/operations/worker-rebalancing.yml
    - cbd/cluster/operations/enable-global-resources.yml
    - prod/prod/ops.yml
    vars_files:
    - cbd/versions.yml
    vars:
      deployment_name: concourse-prod
      web_instances: 3
      worker_instances: 8
      external_url: "https://ci.concourse-ci.org"
      web_vm_type: web
      db_vm_type: database
      worker_vm_type: worker
      untrusted_worker_vm_type: worker
      db_persistent_disk_type: large
      network_name: private
      web_network_name: web
      untrusted_worker_network_name: private
      web_network_vm_extension: concourse-web-target-pool
      untrusted_worker_deny_networks: [10.0.0.0/16]
      untrusted_worker_tags: [pr]
      untrusted_worker_instances: 3
      windows_worker_tsa_host: ci.concourse-ci.org:2222
      windows_worker_os: windows2016
      windows_worker_vm_type: worker
      windows_worker_network_name: windows
      syslog_address: logs2.papertrailapp.com
      syslog_port: '51403'
      syslog_permitted_peer: "*.papertrailapp.com"
      default_task_memory_limit: 5GB
      default_task_cpu_limit: 1024
      worker_rebalance_interval: 30m
